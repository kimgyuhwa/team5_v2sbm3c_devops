<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>Talent 관리 테스트</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; max-width: 600px; margin: auto; }
    input, button, textarea, select { width: 100%; margin: 5px 0 15px; padding: 8px; box-sizing: border-box; }
    textarea { height: 60px; }
    button { cursor: pointer; }
    .section { border: 1px solid #ddd; padding: 15px; margin-bottom: 25px; border-radius: 5px; }
    h2 { margin-top: 0; }
    pre { background: #f4f4f4; padding: 10px; border-radius: 5px; white-space: pre-wrap; word-break: break-word; }
  </style>
</head>
<body>

  <h1>Talent API 통합 테스트</h1>

  <div class="section">
    <h2>1. 등록 (Create)</h2>
    <form id="create-form">
      <input type="number" id="create-userno" placeholder="userno" required />
      <input type="number" id="create-typeno" placeholder="typeno" required />
      <input type="number" id="create-categoryno" placeholder="categoryno" required />
      <input type="number" id="create-schoolno" placeholder="schoolno" required />
      <input type="text" id="create-title" placeholder="title" required />
      <textarea id="create-description" placeholder="description" required></textarea>
      <input type="text" id="create-language" placeholder="language" required />
      <button type="submit">등록</button>
    </form>
    <pre id="create-result"></pre>
  </div>

  <div class="section">
    <h2>2. 전체 목록 조회 (List)</h2>
    <button id="btn-list">목록 불러오기</button>
    <pre id="list-result"></pre>
  </div>

  <div class="section">
    <h2>3. 단건 조회 (Get by ID)</h2>
    <input type="number" id="get-id" placeholder="조회할 talentno 입력" />
    <button id="btn-get">조회</button>
    <pre id="get-result"></pre>
  </div>

  <div class="section">
    <h2>4. 수정 (Update)</h2>
    <form id="update-form">
      <input type="number" id="update-talentno" placeholder="talentno (수정할 대상)" required />
      <input type="text" id="update-title" placeholder="수정할 title" required />
      <textarea id="update-description" placeholder="수정할 description" required></textarea>
      <input type="text" id="update-language" placeholder="수정할 language" required />
      <button type="submit">수정</button>
    </form>
    <pre id="update-result"></pre>
  </div>

  <div class="section">
    <h2>5. 삭제 (Delete)</h2>
    <input type="number" id="delete-id" placeholder="삭제할 talentno 입력" />
    <button id="btn-delete">삭제</button>
    <pre id="delete-result"></pre>
  </div>

  <script>
    // 공통 에러 출력 함수
    function showResult(element, data) {
      if (typeof data === 'string') {
        element.textContent = data;
      } else {
        element.textContent = JSON.stringify(data, null, 2);
      }
    }

    // 1. 등록
    document.getElementById('create-form').addEventListener('submit', async (e) => {
      e.preventDefault();
      const payload = {
        userno: Number(document.getElementById('create-userno').value),
        typeno: Number(document.getElementById('create-typeno').value),
        categoryno: Number(document.getElementById('create-categoryno').value),
        schoolno: Number(document.getElementById('create-schoolno').value),
        title: document.getElementById('create-title').value,
        description: document.getElementById('create-description').value,
        language: document.getElementById('create-language').value,
      };
      const resultEl = document.getElementById('create-result');

      try {
        const res = await fetch('/talent/save', {
          method: 'POST',
          headers: {'Content-Type': 'application/json'},
          body: JSON.stringify(payload)
        });
        if (!res.ok) {
          const text = await res.text();
          showResult(resultEl, `오류: ${res.status}\n${text}`);
          return;
        }
        const data = await res.json();
        showResult(resultEl, data);
      } catch (err) {
        showResult(resultEl, `네트워크 오류: ${err.message}`);
      }
    });

    // 2. 전체 목록 조회
    document.getElementById('btn-list').addEventListener('click', async () => {
      const resultEl = document.getElementById('list-result');
      try {
        const res = await fetch('/talent/list');
        if (!res.ok) {
          const text = await res.text();
          showResult(resultEl, `오류: ${res.status}\n${text}`);
          return;
        }
        const data = await res.json();
        showResult(resultEl, data);
      } catch (err) {
        showResult(resultEl, `네트워크 오류: ${err.message}`);
      }
    });

    // 3. 단건 조회
    document.getElementById('btn-get').addEventListener('click', async () => {
      const id = Number(document.getElementById('get-id').value);
      const resultEl = document.getElementById('get-result');
      if (!id) {
        showResult(resultEl, 'talentno를 입력하세요');
        return;
      }
      try {
        const res = await fetch(`/talent/${id}`);
        if (res.status === 404) {
          showResult(resultEl, '해당 재능을 찾을 수 없습니다.');
          return;
        }
        if (!res.ok) {
          const text = await res.text();
          showResult(resultEl, `오류: ${res.status}\n${text}`);
          return;
        }
        const data = await res.json();
        showResult(resultEl, data);
      } catch (err) {
        showResult(resultEl, `네트워크 오류: ${err.message}`);
      }
    });

    // 4. 수정
    document.getElementById('update-form').addEventListener('submit', async (e) => {
      e.preventDefault();
      const payload = {
        talentno: Number(document.getElementById('update-talentno').value),
        title: document.getElementById('update-title').value,
        description: document.getElementById('update-description').value,
        language: document.getElementById('update-language').value,
      };
      const resultEl = document.getElementById('update-result');
      try {
        const res = await fetch('/talent/update', {
          method: 'PUT',
          headers: {'Content-Type': 'application/json'},
          body: JSON.stringify(payload)
        });
        if (!res.ok) {
          const text = await res.text();
          showResult(resultEl, `오류: ${res.status}\n${text}`);
          return;
        }
        const data = await res.json();
        showResult(resultEl, data);
      } catch (err) {
        showResult(resultEl, `네트워크 오류: ${err.message}`);
      }
    });

    // 5. 삭제
    document.getElementById('btn-delete').addEventListener('click', async () => {
      const id = Number(document.getElementById('delete-id').value);
      const resultEl = document.getElementById('delete-result');
      if (!id) {
        showResult(resultEl, 'talentno를 입력하세요');
        return;
      }
      try {
        const res = await fetch(`/talent/delete/${id}`, {
          method: 'DELETE'
        });
        if (!res.ok) {
          const text = await res.text();
          showResult(resultEl, `오류: ${res.status}\n${text}`);
          return;
        }
        const text = await res.text();
        showResult(resultEl, text);
      } catch (err) {
        showResult(resultEl, `네트워크 오류: ${err.message}`);
      }
    });
  </script>

</body>
</html>
